{# Barber Appointments Table - Shows clients who booked appointments with this barber #}

{% if barberAppointments is empty %}
    <div class="alert alert-info">
        <i class="fas fa-info-circle"></i> Все още нямате записани часове.
    </div>
{% else %}
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Дата и час</th>
                    <th>Клиент</th>
                    <th>Телефон</th>
                    <th>Услуга</th>
                    <th>Продължителност</th>
                    <th>Статус</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody>
                {% for appointment in barberAppointments %}
                    {% set appointmentDate = appointment.date %}
                    {% set isToday = appointmentDate|date('Y-m-d') == 'now'|date('Y-m-d') %}
                    {% set isPast = appointmentDate < 'now'|date_modify('0 seconds') %}

                    <tr class="{{ isToday ? 'table-primary' : '' }} {{ isPast ? 'text-muted' : '' }}">
                        <td>
                            <strong>{{ appointmentDate|date('d.m.Y') }}</strong>
                            <br>
                            <span class="badge badge-secondary">{{ appointmentDate|date('H:i') }}</span>
                            {% if isToday %}
                                <span class="badge badge-info ml-1">Днес</span>
                            {% endif %}
                        </td>
                        <td>
                            <strong>{{ appointment.client.firstName }} {{ appointment.client.lastName }}</strong>
                            {% if appointment.client.nickName %}
                                <br><small class="text-muted">({{ appointment.client.nickName }})</small>
                            {% endif %}
                        </td>
                        <td>
                            {% if appointment.client.phone %}
                                <a href="tel:{{ appointment.client.phone }}">
                                    <i class="fas fa-phone"></i> {{ appointment.client.phone }}
                                </a>
                            {% else %}
                                <span class="text-muted">—</span>
                            {% endif %}
                        </td>
                        <td>
                            {{ appointment.procedureType.type }}
                        </td>
                        <td>
                            {{ appointment.duration }} мин
                        </td>
                        <td>
                            {% if appointment.status == 'confirmed' %}
                                <span class="badge badge-success">Потвърден</span>
                            {% elseif appointment.status == 'completed' %}
                                <span class="badge badge-secondary">Завършен</span>
                            {% elseif appointment.status == 'cancelled' %}
                                <span class="badge badge-danger">Отменен</span>
                            {% else %}
                                <span class="badge badge-warning">{{ appointment.status }}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if not isPast and appointment.status == 'confirmed' %}
                                <button type="button"
                                        class="btn btn-sm btn-success"
                                        onclick="completeAppointment({{ appointment.id }})"
                                        title="Отбележи като завършен">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button type="button"
                                        class="btn btn-sm btn-danger"
                                        onclick="cancelBarberAppointment({{ appointment.id }})"
                                        title="Отмени час">
                                    <i class="fas fa-times"></i>
                                </button>
                            {% else %}
                                <span class="text-muted">—</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endif %}
